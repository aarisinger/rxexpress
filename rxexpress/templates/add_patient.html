{% extends "index.html" %}
{% block content %}
<div class="container mt-4">
  <h2>Add Patient</h2>
  <form method="post">
    {% csrf_token %}
    {{ form.as_p }}
    <button class="btn btn-primary" type="submit">Save</button>
  </form>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const lastNameField = document.getElementById('id_last_name');
    const dobField = document.getElementById('id_date_of_birth');
    const patientIdField = document.getElementById('id_patient_id');

    function updatePatientID() {
      const lastName = lastNameField.value.trim().toUpperCase();
      const dobRaw = dobField.value;
      let dobFormatted = ''
      if (dobRaw && /^\d{4}-\d{2}-\d{2}$/.test(dobRaw)) {
        const [year, month, day] = dobRaw.split('-');
        dobFormatted = `${month}${day}${year}`;
      } else {
        dobFormatted = dobRaw.replace(/\D/g, '');
      }

      if (lastName && dobFormatted.length ===8) {
        patientIdField.value = `${lastName}${dobFormatted}`;
      }else {
        patientIdField.value = '';
      }
    }
    lastNameField.addEventListener('input', updatePatientID);
    dobField.addEventListener('input', updatePatientID);
  });
</script>

{% endblock %}
